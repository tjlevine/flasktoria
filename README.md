# Flasktoria

## What is Flasktoria?

Flasktoria is the REST endpoint which serves as the backend for Smart Transport. The web front end relies on Flasktoria to get vehicle position data, sensor data, vehicle anomaly information, and everything else which is displayed to the user.

## How is Flasktoria built?

![Flasktoria Architecture](https://cto-github.cisco.com/tylevine/flasktoria/raw/master/architecture.png)

Flasktoria is based on the Flask python web server framework, and utilizes the Swagger API definition framework to define all interactions between the server and the client. The swagger file defines several REST methods, along with objects sent by a websocket endpoint which is used for online streaming data. The REST methods are implemented using the Connexion library on top of Flask, and the websocket server is provided by the python package `websockets`.

To gather the required information for correctly implementing the REST methods, Flasktoria utilizes the `impyla` python package to make SQL queries to the PNDA platform, where they are run against an HBase database containing the vehicle sensor data. For the online sensor data, Flasktoria maintains uses the `kafka` python package to maintain a Kafka consumer, which consumes sensor data messages from PNDA. It then transforms the sensor data messages into the proper swagger defined format, then broadcasts them to all currently open websocket connections, where they are consumed by the web front end.

Using these technologies, Flasktoria is able to provide a centralized and well-defined way for the web front end to access both historical and live data from the PNDA platform, without having to know the exact message format or database table schema definitions used for storing the data.

### Viewing the API specification

This server was generated by the [swagger-codegen](https://github.com/swagger-api/swagger-codegen) project. By using the
[OpenAPI-Spec](https://github.com/swagger-api/swagger-core/wiki) from a remote server, you can easily generate a server stub.  This
is an example of building a swagger-enabled Flask server.

This example uses the [Connexion](https://github.com/zalando/connexion) library on top of Flask.

To run the server, please execute the following:

```
sudo pip3 install -U connexion # install Connexion from PyPI
python3 app.py
```

and open your browser to here:

```
http://localhost:8080/api/ui/
```

Your Swagger definition lives here:

```
http://localhost:8080/api/swagger.json
```

